<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="byran"><meta name="description" content="githubmultipleaccountspush问题背景今天碰到了一个往公用github账号pushcommit的需求，发现使用https协议push返回403错误，使用ssh协议返回Permissiondenied。"><meta name="keywords" content="base,github"><title>github-multiple-accounts-push · byran</title><link rel="icon" href="/favicon.ico"><link rel="canonical" href="http://lxang.github.io/2017/03/01/multiple-github-account-push/"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"></head><body><div id="main"><header><a href="/." class="logo">byran</a><ul class="nav"><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Archives</a></li><li class="nav-link"><a href="/categories/" target="_self">Categories</a></li><li class="nav-link"><a href="/tags/" target="_self">Tags</a></li><li class="nav-link"><a href="/about/" target="_self">About</a></li></ul></header><section id="container"><article class="post"><h1 class="post-title">github-multiple-accounts-push</h1><span class="post-time">Mar 1, 2017</span><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#github-multiple-accounts-push"><span class="toc-text">github multiple accounts push</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题背景"><span class="toc-text">问题背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题原因"><span class="toc-text">问题原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决步骤"><span class="toc-text">解决步骤</span></a></li></ol></li></ol></li></ol></div><div class="post-content"><h1 id="github-multiple-accounts-push"><a href="#github-multiple-accounts-push" class="headerlink" title="github multiple accounts push"></a>github multiple accounts push</h1><h3 id="问题背景"><a href="#问题背景" class="headerlink" title="问题背景"></a>问题背景</h3><p>今天碰到了一个往公用github账号push commit的需求， 发现使用https协议push返回403错误，使用ssh协议返回Permission denied。</p>
<a id="more"></a>
<h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><p>该公用账户的ssh key没有当前机器的公钥；</p>
<h3 id="解决步骤"><a href="#解决步骤" class="headerlink" title="解决步骤"></a>解决步骤</h3><ol>
<li>创建新的ssh key<br>因为默认的id_rsa已经被配置到自己的github账户了, 而同一个公钥只能配置一个github账户， 因此需要为新账户生成一个新的公钥。详细可见<a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank" rel="external">官网help</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa -f ~/.ssh/id_rsa_new -C &quot;your_email@example.com&quot;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>默认ssh只会读取id_rsa,  为了让ssh识别新的私钥， 需要将其添加到ssh agent<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-add ~/.ssh/id_rsa_new</div></pre></td></tr></table></figure></p>
<p>另外，确保ssh agent是否启动可以通过下面这个命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">eval $(ssh-agent -s)</div><div class="line">//启动可以用这个命令</div><div class="line">ssh-agent bash</div></pre></td></tr></table></figure></p>
<p>以上这些命令， 如果是windows用户（比如我）需要在git bash里执行</p>
<ol>
<li><p>添加ssh key到github account<br>登录新的github账户， 在头像处找到Settings -&gt; SSH and GPG keys -&gt; New SSH key/Add SSH key。<br>将新生成的公钥<code>id_rsa_new.pub</code>的内容贴进去， title可以自己起个名字。<br>保持即可。</p>
</li>
<li><p>修改ssh config<br>这个时候你在本地就有了两个ssh秘钥, <code>id_rsa</code>(默认)， <code>id_rsa_new</code>。github提交的时候怎么让它用<code>id_rsa_new</code>来认证呢？可以通过在~/.ssh/目录下配置config(如果没有， 可以自己建一个，听说linux下用的文件名是ssh_config)来实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">#a account</div><div class="line">Host github.com</div><div class="line">HostName github.com</div><div class="line">User git</div><div class="line">IdentityFile ~/.ssh/id_rsa</div><div class="line"></div><div class="line">#b account</div><div class="line">Host github.com-b</div><div class="line">HostName github.com</div><div class="line">User git</div><div class="line">IdentityFile ~/.ssh/id_rsa_new</div></pre></td></tr></table></figure>
</li>
</ol>
<p>测试一下， 配置是否生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -T git@github.com-b</div></pre></td></tr></table></figure></p>
<p>然后， 别着急，这里还没有结束哦。<br>你需要把要使用<code>id_rsa_new</code>提交的git仓库的远程地址Host改成git@github.com-b<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git remote set-url origin git@github.com-b:...</div></pre></td></tr></table></figure></p>
</div></article><div class="tags"><a href="/tags/base/">base</a><a href="/tags/github/">github</a></div><div class="paginator"><a href="/2016/09/04/部署hexo遇到的问题汇总/" class="next"><span>Next</span><i class="iconfont icon-right"></i></a></div></section><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2017<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">byran</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script></body></html>